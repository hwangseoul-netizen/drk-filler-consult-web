<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Body Filler MasterLab by Dr.K</title>

  <!-- Supabase -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2/dist/umd/supabase.js"></script>

  <style>
    body {
      margin: 0;
      font-family: 'Pretendard', sans-serif;
      background-color: #1A1A1A;
      color: #E6C2B3;
    }

    header {
      width: 100%;
      padding: 30px 40px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      box-sizing: border-box;
    }

    .logo-box {
      text-align: left;
    }

    .logo-line {
      width: 80px;
      height: 80px;
      background: linear-gradient(135deg, #E6C2B3, #cda394);
      border-radius: 50%;
      margin-bottom: 10px;
    }

    .brand {
      font-size: 24px;
      font-weight: 700;
      margin-bottom: 5px;
    }

    .tagline {
      font-size: 16px;
      opacity: 0.9;
    }

    .top-nav {
      display: flex;
      gap: 16px;
    }

    .nav-btn {
      padding: 10px 18px;
      border: 1px solid #E6C2B3;
      border-radius: 8px;
      cursor: pointer;
      background: transparent;
      color: #E6C2B3;
      font-size: 15px;
    }

    .section {
      padding: 60px 40px;
    }

    .main-title {
      font-size: 32px;
      font-weight: 700;
      margin-bottom: 40px;
    }

    /* Upload /카테고리 */
    .category-grid {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 20px;
      margin-top: 20px;
    }

    .category-box {
      border: 1px solid #E6C2B3;
      border-radius: 12px;
      padding: 25px;
      text-align: center;
      cursor: pointer;
      transition: 0.2s;
    }

    .category-box:hover {
      background-color: #2A2A2A;
    }

    /* Upload */
    #upload-section {
      display: none;
    }

    input, select, textarea {
      width: 100%;
      padding: 14px;
      margin-top: 10px;
      background: #2A2A2A;
      border: 1px solid #E6C2B3;
      border-radius: 8px;
      color: #E6C2B3;
      box-sizing: border-box;
    }

    .upload-btn {
      margin-top: 20px;
      padding: 14px 22px;
      background: #E6C2B3;
      color: #1A1A1A;
      border-radius: 8px;
      cursor: pointer;
      border: none;
      font-size: 16px;
    }

    /* Doctor Mode */
    #doctor-login, #doctor-panel {
      display: none;
    }

    .chart-box {
      border: 1px solid #E6C2B3;
      padding: 20px;
      margin-bottom: 20px;
      border-radius: 10px;
    }

  </style>
</head>

<body>

<header>
  <div class="logo-box">
    <div class="logo-line"></div>
    <div class="brand">Body Filler MasterLab by Dr.K</div>
    <div class="tagline">바디필러 시술이 아닌 예술을 원한다면. 바디필러 마스터랩에 고민상담부터.</div>
  </div>

  <div class="top-nav">
    <button class="nav-btn" onclick="openClient()">상담자 모드</button>
    <button class="nav-btn" onclick="openDoctor()">닥터 모드</button>
  </div>
</header>

<!-- Home -->
<section class="section" id="home-section">
  <div class="main-title">당신의 바디 실루엣을 과학과 예술로 재구성합니다.</div>

  <div class="category-grid">
    <div class="category-box" onclick="openUpload('어깨')">어깨</div>
    <div class="category-box" onclick="openUpload('가슴')">가슴</div>
    <div class="category-box" onclick="openUpload('골반')">골반</div>
    <div class="category-box" onclick="openUpload('힙')">힙</div>
    <div class="category-box" onclick="openUpload('허벅지')">허벅지</div>
    <div class="category-box" onclick="openUpload('무릎')">무릎</div>
    <div class="category-box" onclick="openUpload('종아리')">종아리</div>
    <div class="category-box" onclick="openUpload('팔/전완근')">팔/전완근</div>
  </div>
</section>

<!-- 상담자 업로드 -->
<section class="section" id="upload-section">
  <h2 id="upload-title"></h2>

  <label>정면 사진</label>
  <input type="file" id="front" />

  <label>측면 사진</label>
  <input type="file" id="side" />

  <label>후면 사진</label>
  <input type="file" id="back" />

  <label>45도 영상 또는 사진</label>
  <input type="file" id="angle45" />

  <label>워너비 / 참고 이미지 (선택)</label>
  <input type="file" id="reference" />

  <label>시술/수술 과거력</label>
  <textarea id="history" placeholder="보형물, 지방흡입 등 입력"></textarea>

  <button class="upload-btn" onclick="submitCase()">상담 요청하기</button>
</section>

<!-- 닥터 로그인 -->
<section class="section" id="doctor-login">
  <h2>닥터 모드 로그인</h2>
  <input type="password" id="doctor-pin" maxlength="6" placeholder="6자리 PIN 입력" />
  <button class="upload-btn" onclick="doctorVerify()">로그인</button>
</section>

<!-- 닥터 패널 -->
<section class="section" id="doctor-panel">
  <h2>저장된 상담 케이스</h2>
  <div id="case-list"></div>
</section>

<script>
  const supabaseUrl = "https://mljhxswtlahjqexlxlwh.supabase.co";
  const supabaseKey = "sb_publishable_zhjzgeDAxcImr4july-7Pw_2h2DQAc3";
  const supabaseClient = supabase.createClient(supabaseUrl, supabaseKey);

  function openClient() {
    document.getElementById("home-section").style.display = "block";
    document.getElementById("upload-section").style.display = "none";
    document.getElementById("doctor-login").style.display = "none";
    document.getElementById("doctor-panel").style.display = "none";
  }

  function openDoctor() {
    document.getElementById("home-section").style.display = "none";
    document.getElementById("upload-section").style.display = "none";
    document.getElementById("doctor-login").style.display = "block";
  }

  function openUpload(part) {
    document.getElementById("home-section").style.display = "none";
    document.getElementById("upload-section").style.display = "block";
    document.getElementById("upload-title").innerText = `${part} 상담 업로드`;
  }

  async function submitCase() {
    const history = document.getElementById("history").value;

    const { data, error } = await supabaseClient
      .from("cases")
      .insert([{ history }]);

    alert("상담이 정상적으로 접수되었습니다.");
    openClient();
  }

  function doctorVerify() {
    const pin = document.getElementById("doctor-pin").value;
    if (pin === "123456") {
      document.getElementById("doctor-login").style.display = "none";
      document.getElementById("doctor-panel").style.display = "block";
      loadCases();
    } else {
      alert("PIN이 올바르지 않습니다.");
    }
  }

  async function loadCases() {
    const { data } = await supabaseClient.from("cases").select("*");

    let html = "";
    data.forEach(c => {
      html += `
        <div class="chart-box">
          <div><b>과거력:</b> ${c.history}</div>
        </div>
      `;
    });

    document.getElementById("case-list").innerHTML = html;
  }
</script>

</body>
</html>
